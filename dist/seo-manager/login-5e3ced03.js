import{_ as e,s as o}from"./serverCall-38480fea.js";import i from"react";import{connect as t}from"react-redux";import{DialogTitle as r,IconButton as s,DialogContent as l,Box as n,Typography as d}from"@mui/material";import u from"@mui/icons-material/Close";import a from"@mui/icons-material/LockOutlined";import{f as v}from"./firebase-f83deced.js";import{getAuth as p}from"firebase/auth";import{B as c}from"./BootstrapDialog-a7648b0f.js";import"axios";import"./index-bfbf5fdc.js";import"firebase/app";import"@mui/material/styles";const m=p(v);class h extends i.Component{constructor(i){var t,r;super(i),this.componentDidMount=()=>{var e,o,i,t;const r=null===(o=null===(e=this.props)||void 0===e?void 0:e.user)||void 0===o?void 0:o.isLoggedIn,s=null===(t=null===(i=this.props)||void 0===i?void 0:i.user)||void 0===t?void 0:t.authorizedProject;this.setState({userAuthorized:s,userLoaded:r,userSetup:!1})},this.componentDidUpdate=e=>{var o,i,t,r,s,l,n,d,u,a;(null===(o=null==e?void 0:e.user)||void 0===o?void 0:o.isLoggedIn)===(null===(t=null===(i=this.props)||void 0===i?void 0:i.user)||void 0===t?void 0:t.isLoggedIn)&&(null===(r=null==e?void 0:e.user)||void 0===r?void 0:r.authorizedProject)===(null===(l=null===(s=this.props)||void 0===s?void 0:s.user)||void 0===l?void 0:l.authorizedProject)||(this.setState({userAuthorized:null===(d=null===(n=this.props)||void 0===n?void 0:n.user)||void 0===d?void 0:d.authorizedProject,userLoaded:null===(a=null===(u=this.props)||void 0===u?void 0:u.user)||void 0===a?void 0:a.isLoggedIn}),this.userLoginSetup())},this.userLoginSetup=()=>{var i,t,r,s,l;const n=null===(t=null===(i=this.props)||void 0===i?void 0:i.user)||void 0===t?void 0:t.isLoggedIn,d=null===(s=null===(r=this.props)||void 0===r?void 0:r.user)||void 0===s?void 0:s.authorizedProject;!0===n&&!1===d&&!1===this.state.userSetup&&(this.setState({userSetup:!0}),null===(l=null==m?void 0:m.currentUser)||void 0===l||l.getIdToken().then(i=>e(this,void 0,void 0,function*(){var e,t,r,s,l;console.log(this.props);const n=yield o("/seo/setup_authorization","post",{pageId:null===(s=null===(r=null===(t=null===(e=this.props)||void 0===e?void 0:e.seoData)||void 0===t?void 0:t.initial)||void 0===r?void 0:r.page)||void 0===s?void 0:s.pageId},void 0,{X_Authorization:i,AuthorizationId:null===(l=null==m?void 0:m.currentUser)||void 0===l?void 0:l.uid});console.log("Authorization Setup Response: ",n)})))},this.state={loading:!1,loginError:"",userAuthorized:null===(t=null==i?void 0:i.user)||void 0===t?void 0:t.authorizedProject,userLoaded:null===(r=null==i?void 0:i.user)||void 0===r?void 0:r.isLoggedIn,userSetup:!1}}render(){return this.state.userAuthorized||!this.state.userLoaded?null:i.createElement(i.Fragment,null,i.createElement(c,{onClose:this.props.onClose,"aria-labelledby":"SEO Manager Login",open:!0,maxWidth:!1,style:{zIndex:100}},i.createElement(r,{sx:{m:0,p:2}},"Login",i.createElement(s,{"aria-label":"close",onClick:this.props.onClose,sx:{position:"absolute",right:12,top:10,color:"#94a3b8","&:hover":{color:"#f8fafc",backgroundColor:"rgba(255,255,255,0.1)"}}},i.createElement(u,{fontSize:"small"}))),i.createElement(l,null,i.createElement(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:4,gap:2}},i.createElement(n,{sx:{width:56,height:56,borderRadius:"50%",backgroundColor:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",mb:1}},i.createElement(a,{sx:{color:"#475569",fontSize:28}})),i.createElement(d,{sx:{color:"#1e293b",fontSize:"1rem",fontWeight:600}},"Authentication Required"),i.createElement(d,{sx:{color:"#64748b",fontSize:"0.9rem",textAlign:"center",maxWidth:400,lineHeight:1.6}},"Please login to your SEO Manager account to continue. Scan the QR Code or use the redirect link to authenticate.")))))}}var g=t(e=>({user:null==e?void 0:e.user,seoData:null==e?void 0:e.seoData}))(h);export{g as default};
