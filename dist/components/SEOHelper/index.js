import{__awaiter as e}from"../../node_modules/tslib/tslib.es6.js";import t from"react";import{returnKey as a}from"../../utils/Init.js";import"./styles.css.js";import{firebase as s}from"../../firebase.js";import{getAnalytics as i}from"firebase/analytics";import{getStorage as n,ref as r,uploadBytesResumable as o,getDownloadURL as l}from"firebase/storage";import{getAuth as m,onAuthStateChanged as d,signInWithEmailAndPassword as c,signOut as p}from"firebase/auth";import h from"./Manager.js";import{addFiles as g}from"./utils.js";n(s);const u=m(s);class E extends t.Component{constructor(n){super(n),this.componentDidMount=()=>{console.log("SEOHelper Mounted:",Date.now()),this.setState({loading:!0,user:!1,loaded:!0}),d(u,(t=>e(this,void 0,void 0,(function*(){var e;if(t){const a=yield t.getIdTokenResult(!0),s=Object.assign(Object.assign({},t),{customClaims:a.claims});"admin"===(null===(e=null==a?void 0:a.claims)||void 0===e?void 0:e[this.state.projectId])?this.setState({authorizedUser:!0}):this.setState({authorizedUser:!1}),this.setState({user:s})}else this.setState({user:!1});this.setState({loading:!1}),i(s)}))))},this.checkComponentErrors=e=>{if(!e.data)throw"Please add this tag to your SEOHelper component 'data={this.props.seo}'. If you are using NextJS make sure you are calling our fetchSEO function in getServerSideProps or getStaticProps and passing the data as a prop.";if(!e.head)throw"Please add this tag to your SEOHelper component 'head={(data) => (<Head>{data}</Head>)}'. If your not using NextJS replace <Head>{data}</Head> with <Helmet>{data}</Helmet> from npm react-helmet."},this.formatHead=e=>e&&!1!==e.valid?t.createElement(t.Fragment,null,t.createElement("title",null,e.title||""),t.createElement("meta",{name:"description",content:e.description||"",key:"description"}),e.keywords&&t.createElement("meta",{name:"keywords",content:e.keywords}),e.canonicalURL&&t.createElement("link",{href:`${e.canonicalURL}${e.path}`,rel:"canonical"}),t.createElement("meta",{property:"og:locale",content:"en_US"}),t.createElement("meta",{property:"og:type",content:"website"}),e.title&&t.createElement("meta",{property:"og:title",content:e.title}),e.description&&t.createElement("meta",{property:"og:description",content:e.description}),e.image&&t.createElement("meta",{property:"og:image",content:e.image}),e.canonicalURL&&t.createElement("meta",{property:"og:url",content:`${e.canonicalURL}${e.path}`}),e.title&&t.createElement("meta",{name:"twitter:title",content:e.title}),e.description&&t.createElement("meta",{name:"twitter:description",content:e.description}),e.image&&t.createElement("meta",{name:"twitter:image",content:e.image}),(e.pageFavicon||e.projectFavicon)&&t.createElement("link",{rel:"icon",type:"image/x-icon",href:e.pageFavicon||e.projectFavicon,sizes:"192x192"}),t.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),t.createElement("meta",{name:"robots",content:`${e.index||"index"}, ${e.follow||"follow"}`}),!0!==this.props.hideBootstrap&&this.state&&!0===this.state.open&&t.createElement("link",{href:"https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css",rel:"stylesheet",integrity:"sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC",crossOrigin:"anonymous"}),this.props.children):null,this.signIn=t=>e(this,void 0,void 0,(function*(){t.preventDefault(),this.setState({loading:!0}),c(u,this.state.email,this.state.password).then((e=>{this.setState({loading:!1})})).catch((e=>{e.message,this.setState({loginError:e.code,loading:!1})}))})),this.signOut=()=>e(this,void 0,void 0,(function*(){yield p(u)})),this.resetData=()=>{this.setState({data:this.state.dataOriginal,openManager:!1})},this.updateData=(e,t)=>{this.setState({data:e}),!0===t&&this.setState({dataOriginal:e})},this.openManager=e=>{var t,a,s;"admin"!==(null===(a=null===(t=this.state.user)||void 0===t?void 0:t.customClaims)||void 0===a?void 0:a[this.state.projectId])&&"admin"!==(null===(s=null==e?void 0:e.customClaims)||void 0===s?void 0:s[this.state.projectId])||this.setState({openManager:!0})},this.checkComponentErrors(n);const r=a();this.state={data:n.data,dataOriginal:n.data,head:n.head(this.formatHead(n.data)),loading:!1,loaded:!1,open:!0,user:null,email:"",password:"",loginError:"",projectId:r.projectId,authorizedUser:!1,openManager:!1}}render(){return t.createElement(t.Fragment,null,!1===this.state.loading&&null===this.state.user?t.createElement(t.Fragment,null,this.state.head):t.createElement(t.Fragment,null,this.props.head(this.formatHead(this.state.data))),this.state&&!1===this.state.loaded&&t.createElement("script",{src:"https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js",integrity:"sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM",crossOrigin:"anonymous"}),t.createElement("button",{type:"button",className:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#staticBackdrop",id:"open-seo-manager",style:{display:"none"},onClick:this.openManager}),t.createElement("div",{className:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:-1,"aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},t.createElement("div",{className:"modal-dialog modal-dialog-centered modal-lg"},t.createElement("div",{className:"modal-content"},t.createElement("div",{className:"modal-header"},t.createElement("h5",{className:"modal-title",id:"staticBackdropLabel"},"SEO Manager"),t.createElement("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:this.resetData})),t.createElement("div",{className:"modal-body"},!1===this.state.user&&!1===this.state.loading&&t.createElement("form",{onSubmit:this.signIn},t.createElement("label",{htmlFor:"",className:"form-label"},"Please login to your SEO Manager Account to continue"),t.createElement("div",{className:"form-floating mb-3"},t.createElement("input",{type:"email",className:"form-control",id:"floatingInput",placeholder:"name@example.com",onChange:e=>{this.setState({email:e.target.value})},required:!0}),t.createElement("label",{htmlFor:"floatingInput"},"Email address")),t.createElement("div",{className:"form-floating"},t.createElement("input",{type:"password",className:"form-control",id:"floatingPassword",placeholder:"Password",onChange:e=>{this.setState({password:e.target.value})},required:!0}),t.createElement("label",{htmlFor:"floatingPassword"},"Password")),this.state.loginError&&t.createElement("div",{className:"alert alert-danger d-flex align-items-center",role:"alert",style:{marginTop:15}},t.createElement("svg",{className:"bi flex-shrink-0 me-2",width:"24",height:"24",role:"img","aria-label":"Danger:"},t.createElement("use",{xlinkHref:"#exclamation-triangle-fill"})),t.createElement("div",null,this.state.loginError)),t.createElement("div",{className:"d-grid gap-2"},t.createElement("button",{className:"btn btn-dark",type:"submit",style:{marginTop:15}},"Login"))),!0===this.state.loading&&t.createElement("div",{style:{width:"100%",height:400,display:"flex",justifyContent:"center",alignItems:"center"}},t.createElement("div",{className:"spinner-border",role:"status"},t.createElement("span",{className:"visually-hidden"},"Loading..."))),!1===this.state.loading&&this.state.user&&!0===this.state.authorizedUser&&!0===this.state.openManager&&t.createElement(h,{onChange:this.updateData,data:this.state.data,dataOriginal:this.state.dataOriginal,resetData:this.resetData,onChangeComplete:this.props.onChangeComplete,user:this.state.user}),!1===this.state.loading&&this.state.user&&!1===this.state.authorizedUser&&t.createElement("div",null,t.createElement("p",null,"Unfortunately it appears you are not authorized to make changes to this website! Is it possible your signed in on the wrong account?"," ",t.createElement("a",{onClick:this.signOut,style:{cursor:"pointer"}},t.createElement("strong",null,"Click Here to Sign Out")))))))))}}t.Component;export default E;
//# sourceMappingURL=index.js.map
